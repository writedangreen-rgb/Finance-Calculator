
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Semcasting | Incremental Media Performance Calculator (Demo)</title>
  <style>
    :root{
      --bg:#f8f9fb;
      --card:#ffffff;
      --border:#d6dbe6;
      --border2:#c7cfde;
      --text:#111111;
      --muted:rgba(17,17,17,.78);
      --muted2:rgba(17,17,17,.60);
      --accent:#2f5bff;
      --accent-light:rgba(47,91,255,.10);
      --success:#10b981;
      --info-bg:#f0f4ff;
      --info-border:#d0ddff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    
    * { box-sizing: border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); }
    
    /* Header */
    .header{
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 1px 3px rgba(0,0,0,.04);
    }
    .header-inner{
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{
      width:34px; height:34px; border-radius:10px;
      background: linear-gradient(135deg, var(--accent), #7aa2ff);
      box-shadow: 0 4px 12px rgba(47,91,255,.18);
    }
    .brand h1{ font-size: 16px; margin:0; letter-spacing:.2px; }
    .brand .sub{ font-size: 12px; color: var(--muted2); margin: 2px 0 0; }

    .header-actions{ display:flex; gap:10px; }
    button, select{
      border:1px solid var(--border2); background:#fff; color:var(--text);
      border-radius: 10px; padding: 9px 14px; cursor:pointer; font-size: 13px;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    button:hover, select:hover{ 
      border-color: var(--accent); 
      background: rgba(47,91,255,.04);
    }
    .btn-primary{
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .btn-primary:hover{
      background: #2750e0;
      border-color: #2750e0;
    }

    /* Progress stepper */
    .progress-container{
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 20px 24px;
    }
    .progress-inner{
      max-width: 1400px;
      margin: 0 auto;
    }
    .stepper{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .step{
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .step-circle{
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e5e7eb;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      transition: all 0.3s ease;
    }
    .step.active .step-circle{
      background: var(--accent);
      color: #fff;
      box-shadow: 0 0 0 4px rgba(47,91,255,.15);
    }
    .step.completed .step-circle{
      background: var(--success);
      color: #fff;
    }
    .step-label{
      font-size: 13px;
      font-weight: 600;
      color: var(--muted2);
      display: none;
    }
    .step.active .step-label{
      color: var(--accent);
      display: block;
    }
    .step-connector{
      width: 40px;
      height: 2px;
      background: #e5e7eb;
      transition: all 0.3s ease;
    }
    .step.completed + .step-connector{
      background: var(--success);
    }
    
    .progress-bar-wrap{
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-bar{
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #7aa2ff);
      border-radius: 999px;
      transition: width 0.4s ease;
    }

    /* Main layout */
    .container{
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 24px;
    }
    
    .wizard-layout{
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      align-items: start;
    }

    /* Left panel - inputs */
    .input-panel{
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,.04);
    }
    .panel-title{
      font-size: 24px;
      font-weight: 800;
      margin: 0 0 8px;
      color: var(--text);
    }
    .panel-subtitle{
      font-size: 14px;
      color: var(--muted2);
      margin: 0 0 28px;
      line-height: 1.5;
    }

    .field-group{
      margin-bottom: 24px;
    }
    .field-group:last-child{
      margin-bottom: 0;
    }
    
    label{
      display: block;
      font-size: 14px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
    }
    
    .input-wrap{
      position: relative;
    }
    .input-wrap .prefix, .input-wrap .suffix{
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 15px;
      font-weight: 700;
      color: var(--muted);
      pointer-events: none;
    }
    .input-wrap .prefix{ left: 14px; }
    .input-wrap .suffix{ right: 14px; }
    
    input, select{
      width: 100%;
      padding: 12px 14px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      background: #fff;
      color: var(--text);
      transition: all 0.2s ease;
      outline: none;
    }
    input:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(47,91,255,.1);
    }
    .pad-left{ padding-left: 32px !important; }
    .pad-right{ padding-right: 32px !important; }
    
    .hint{
      font-size: 12px;
      color: var(--muted2);
      margin-top: 6px;
      font-weight: 600;
    }

    /* Right panel - info/text */
    .info-panel{
      position: sticky;
      top: 100px;
      background: var(--info-bg);
      border: 2px solid var(--info-border);
      border-radius: 16px;
      padding: 32px;
      min-height: 300px;
    }
    .info-title{
      font-size: 20px;
      font-weight: 800;
      margin: 0 0 16px;
      color: var(--accent);
    }
    .info-content{
      font-size: 14px;
      line-height: 1.7;
      color: var(--text);
    }
    .info-content p{
      margin: 0 0 14px;
    }
    .info-content p:last-child{
      margin-bottom: 0;
    }
    .info-content ul{
      margin: 12px 0;
      padding-left: 20px;
    }
    .info-content li{
      margin-bottom: 8px;
    }
    .info-highlight{
      background: rgba(47,91,255,.08);
      border-left: 3px solid var(--accent);
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
      font-size: 13px;
      font-weight: 600;
    }

    /* Navigation buttons */
    .nav-buttons{
      display: flex;
      gap: 12px;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }
    .btn-nav{
      flex: 1;
      padding: 14px 24px;
      font-size: 15px;
      font-weight: 700;
      border-radius: 12px;
      border: 2px solid var(--border2);
      background: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-nav:hover{
      border-color: var(--accent);
      background: var(--accent-light);
    }
    .btn-nav.primary{
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .btn-nav.primary:hover{
      background: #2750e0;
      border-color: #2750e0;
    }
    .btn-nav:disabled{
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Results page */
    .results-grid{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 24px;
    }
    .result-card{
      background: #fff;
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s ease;
    }
    .result-card:hover{
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(0,0,0,.06);
    }
    .result-label{
      font-size: 12px;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    .result-value{
      font-size: 28px;
      font-weight: 900;
      color: var(--text);
      margin-bottom: 6px;
    }
    .result-desc{
      font-size: 12px;
      color: var(--muted2);
      line-height: 1.4;
    }

    /* Page transitions */
    .page{
      display: none;
    }
    .page.active{
      display: block;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn{
      from{ opacity: 0; transform: translateY(10px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    .err{
      background: #fee;
      border: 1px solid #fcc;
      color: #c00;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      margin-top: 16px;
      display: none;
    }

    /* Responsive */
    @media (max-width: 968px){
      .wizard-layout{
        grid-template-columns: 1fr;
      }
      .info-panel{
        position: static;
        order: -1;
      }
      .stepper{
        flex-wrap: wrap;
      }
      .step-label{
        display: none !important;
      }
      .results-grid{
        grid-template-columns: 1fr;
      }
    }

    @media print{
      .header, .progress-container, .nav-buttons, .info-panel{ display:none !important; }
      body{ background:#fff; }
      .input-panel{ border:0; box-shadow:none; }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Semcasting</h1>
          <div class="sub">Incremental Media Performance Calculator</div>
        </div>
      </div>
      <div class="header-actions">
        <select id="benchmarkSelect" title="Benchmark preset">
          <option value="standard">Standard Benchmark</option>
          <option value="conservative">Conservative Benchmark</option>
          <option value="aggressive">Aggressive Benchmark</option>
        </select>
        <button id="resetBtn" type="button">Reset</button>
      </div>
    </div>
  </div>

  <!-- Progress -->
  <div class="progress-container">
    <div class="progress-inner">
      <div class="stepper">
        <div class="step" data-step="1">
          <div class="step-circle">1</div>
          <div class="step-label">Budget</div>
        </div>
        <div class="step-connector"></div>
        <div class="step" data-step="2">
          <div class="step-circle">2</div>
          <div class="step-label">Performance</div>
        </div>
        <div class="step-connector"></div>
        <div class="step" data-step="3">
          <div class="step-circle">3</div>
          <div class="step-label">Conversion</div>
        </div>
        <div class="step-connector"></div>
        <div class="step" data-step="4">
          <div class="step-circle">4</div>
          <div class="step-label">Value</div>
        </div>
        <div class="step-connector"></div>
        <div class="step" data-step="5">
          <div class="step-circle">5</div>
          <div class="step-label">Results</div>
        </div>
      </div>
      <div class="progress-bar-wrap">
        <div class="progress-bar" id="progressBar" style="width: 20%"></div>
      </div>
    </div>
  </div>

  <!-- Main content -->
  <div class="container">
    <!-- Page 1: Budget & CPM -->
    <div class="page active" id="page1">
      <div class="wizard-layout">
        <div class="input-panel">
          <h2 class="panel-title">Budget & Media Cost</h2>
          <p class="panel-subtitle">Start by entering your digital marketing budget and estimated cost per thousand impressions.</p>

          <div class="field-group">
            <label for="budget">Display & CTV Digital Marketing Budget</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input id="budget" class="money pad-left" inputmode="numeric" value="10,000,000" required>
            </div>
            <div class="hint">Your total annual budget for display and CTV campaigns</div>
          </div>

          <div class="field-group">
            <label for="cpm">Blended CPM (Cost Per Thousand)</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input id="cpm" class="money pad-left" inputmode="decimal" value="15.00" required>
            </div>
            <div class="hint">Average cost to reach 1,000 impressions across all channels</div>
          </div>

          <div class="nav-buttons">
            <button class="btn-nav" disabled>Previous</button>
            <button class="btn-nav primary" onclick="nextPage()">Next Step</button>
          </div>
        </div>

        <div class="info-panel">
          <h3 class="info-title">Understanding Your Media Investment</h3>
          <div class="info-content">
            <p>Your <strong>digital marketing budget</strong> is the foundation of your campaign reach. This includes all spending on display advertising and Connected TV (CTV) campaigns.</p>
            
            <p>The <strong>CPM (Cost Per Mille)</strong> represents how efficiently you're buying media. Lower CPMs mean more impressions for your budget, while higher CPMs often indicate premium placements or targeted audiences.</p>
            
            <div class="info-highlight">
              ðŸ’¡ <strong>Tip:</strong> A blended CPM of $15-25 is typical for financial services. Premium placements and highly targeted audiences may cost $30-50 CPM.
            </div>
            
            <p><strong>Why this matters:</strong></p>
            <ul>
              <li>Budget and CPM determine your total impression volume</li>
              <li>More impressions = more opportunities to reach prospects</li>
              <li>Efficient CPMs maximize your campaign reach</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Page 2: Performance Metrics -->
    <div class="page" id="page2">
      <div class="wizard-layout">
        <div class="input-panel">
          <h2 class="panel-title">Campaign Performance</h2>
          <p class="panel-subtitle">Enter your expected click-through and view-through rates, plus current site traffic.</p>

          <div class="field-group">
            <label for="ctr">Click-Through / View-Through Rate</label>
            <div class="input-wrap">
              <input id="ctr" class="pad-right" inputmode="decimal" value="0.15" required>
              <span class="suffix">%</span>
            </div>
            <div class="hint">Percentage of impressions that result in clicks or engaged views</div>
          </div>

          <div class="field-group">
            <label for="siteVisitors">Current Site Visitors (Annual)</label>
            <input id="siteVisitors" inputmode="numeric" value="1,200,000" required>
            <div class="hint">Total number of unique visitors to your site per year</div>
          </div>

          <div class="nav-buttons">
            <button class="btn-nav" onclick="prevPage()">Previous</button>
            <button class="btn-nav primary" onclick="nextPage()">Next Step</button>
          </div>
        </div>

        <div class="info-panel">
          <h3 class="info-title">Measuring Campaign Engagement</h3>
          <div class="info-content">
            <p>The <strong>CTR/VTR</strong> shows how compelling your creative is and how well you're targeting the right audience. This metric bridges the gap between impressions and actual site traffic.</p>
            
            <div class="info-highlight">
              ðŸ’¡ <strong>Benchmark:</strong> Financial services typically see 0.10-0.25% CTR for display ads. CTV campaigns often have lower direct CTR but higher brand lift.
            </div>
            
            <p><strong>Current site visitors</strong> provides context for your existing funnel performance. Understanding your baseline helps measure the true incremental impact of new campaigns.</p>
            
            <p><strong>What to expect:</strong></p>
            <ul>
              <li>Display ads: 0.10-0.20% CTR average</li>
              <li>CTV campaigns: Focus on view-through attribution</li>
              <li>Financial products: Lower CTR but higher intent</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Page 3: Conversion Funnel -->
    <div class="page" id="page3">
      <div class="wizard-layout">
        <div class="input-panel">
          <h2 class="panel-title">Conversion Funnel</h2>
          <p class="panel-subtitle">Define your application funnel from start to completion to funding.</p>

          <div class="field-group">
            <label for="startRate">Application Start Rate</label>
            <div class="input-wrap">
              <input id="startRate" class="pad-right" inputmode="decimal" value="0.40" required>
              <span class="suffix">%</span>
            </div>
            <div class="hint">Percentage of visitors who begin the application process</div>
          </div>

          <div class="field-group">
            <label for="completionRate">Application Completion Rate</label>
            <div class="input-wrap">
              <input id="completionRate" class="pad-right" inputmode="decimal" value="40.00" required>
              <span class="suffix">%</span>
            </div>
            <div class="hint">Percentage of started applications that are completed</div>
          </div>

          <div class="field-group">
            <label for="fundedRate">Application Funded Rate</label>
            <div class="input-wrap">
              <input id="fundedRate" class="pad-right" inputmode="decimal" value="50.00" required>
              <span class="suffix">%</span>
            </div>
            <div class="hint">Percentage of completed applications that get funded</div>
          </div>

          <div class="nav-buttons">
            <button class="btn-nav" onclick="prevPage()">Previous</button>
            <button class="btn-nav primary" onclick="nextPage()">Next Step</button>
          </div>
        </div>

        <div class="info-panel">
          <h3 class="info-title">Optimizing Your Funnel</h3>
          <div class="info-content">
            <p>Your conversion funnel shows where prospects drop off between awareness and closing. Each stage represents a critical decision point.</p>
            
            <p><strong>Application Start Rate:</strong> The bridge between browsing and serious intent. Higher rates indicate strong value proposition and clear calls-to-action.</p>
            
            <p><strong>Completion Rate:</strong> Measures friction in your application process. Abandonment often happens due to complexity or time requirements.</p>
            
            <p><strong>Funded Rate:</strong> Reflects credit quality of applicants and your underwriting criteria. This is where qualification meets approval.</p>
            
            <div class="info-highlight">
              ðŸ’¡ <strong>Industry averages:</strong><br>
              Start Rate: 0.3-0.6%<br>
              Completion: 35-45%<br>
              Funded: 45-60%
            </div>
            
            <p><strong>Optimization opportunities:</strong></p>
            <ul>
              <li>Simplify application flow to boost completion</li>
              <li>Better pre-qualification to improve funded rate</li>
              <li>A/B test CTAs to increase start rate</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Page 4: Value & Lift -->
    <div class="page" id="page4">
      <div class="wizard-layout">
        <div class="input-panel">
          <h2 class="panel-title">Value & Measurement Impact</h2>
          <p class="panel-subtitle">Enter the lifetime value of each customer and expected measurement lift.</p>

          <div class="field-group">
            <label for="ltv">Lifetime Value Per Funded Loan</label>
            <div class="input-wrap">
              <span class="prefix">$</span>
              <input id="ltv" class="money pad-left" inputmode="decimal" value="9,000.00" required>
            </div>
            <div class="hint">Total revenue generated from each successfully funded mortgage</div>
          </div>

          <div class="field-group">
            <label for="liftPct">Incremental Lift from Measurement</label>
            <div class="input-wrap">
              <input id="liftPct" class="pad-right" inputmode="decimal" value="10.00" required>
              <span class="suffix">%</span>
            </div>
            <div class="hint">Expected improvement in conversions through better measurement</div>
          </div>

          <div class="field-group">
            <label for="notes">Notes (Optional)</label>
            <input id="notes" type="text" placeholder="Campaign name, assumptions, or other context...">
            <div class="hint">Add any relevant context for your calculation</div>
          </div>

          <div id="err" class="err"></div>

          <div class="nav-buttons">
            <button class="btn-nav" onclick="prevPage()">Previous</button>
            <button class="btn-nav primary" onclick="calculate()">Calculate Results</button>
          </div>
        </div>

        <div class="info-panel">
          <h3 class="info-title">Quantifying Success</h3>
          <div class="info-content">
            <p><strong>Lifetime Value (LTV)</strong> represents the total profit you earn from each funded loan over its lifetime. This includes origination fees, servicing revenue, and any other monetization.</p>
            
            <div class="info-highlight">
              ðŸ’¡ <strong>Typical LTV for mortgages:</strong> $8,000-12,000 depending on loan size, rate, and whether you service or sell the loan.
            </div>
            
            <p><strong>Measurement Lift</strong> quantifies how better attribution and insights improve campaign performance. When you can accurately measure what works, you optimize faster and waste less budget.</p>
            
            <p><strong>How measurement creates lift:</strong></p>
            <ul>
              <li><strong>Better targeting:</strong> Identify and reach high-intent audiences</li>
              <li><strong>Creative optimization:</strong> Double down on messaging that converts</li>
              <li><strong>Channel allocation:</strong> Shift spend to highest-performing channels</li>
              <li><strong>Reduced waste:</strong> Eliminate underperforming campaigns faster</li>
            </ul>
            
            <p>Industry studies show measurement-driven optimization typically delivers 7-15% lift in campaign performance over baseline approaches.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Page 5: Results -->
    <div class="page" id="page5">
      <div class="wizard-layout">
        <div class="input-panel">
          <h2 class="panel-title">Your Results</h2>
          <p class="panel-subtitle">Here's the projected impact of your campaign with measurement-driven optimization.</p>

          <div class="results-grid">
            <div class="result-card">
              <div class="result-label">Total Impressions</div>
              <div class="result-value" id="o_impr">â€”</div>
              <div class="result-desc" id="o_impr_mini">â€”</div>
            </div>

            <div class="result-card">
              <div class="result-label">Application Starts</div>
              <div class="result-value" id="o_starts">â€”</div>
              <div class="result-desc" id="o_starts_mini">â€”</div>
            </div>

            <div class="result-card">
              <div class="result-label">Applications Completed</div>
              <div class="result-value" id="o_comp">â€”</div>
              <div class="result-desc" id="o_comp_mini">â€”</div>
            </div>

            <div class="result-card">
              <div class="result-label">Loans Funded</div>
              <div class="result-value" id="o_funded">â€”</div>
              <div class="result-desc" id="o_funded_mini">â€”</div>
            </div>

            <div class="result-card">
              <div class="result-label">Base Revenue</div>
              <div class="result-value" id="o_rev_base">â€”</div>
              <div class="result-desc" id="o_rev_base_mini">Without measurement optimization</div>
            </div>

            <div class="result-card">
              <div class="result-label">Revenue with Measurement</div>
              <div class="result-value" id="o_rev_meas">â€”</div>
              <div class="result-desc" id="o_rev_meas_mini">With measurement optimization</div>
            </div>

            <div class="result-card" style="border-color: var(--success); border-width: 3px;">
              <div class="result-label" style="color: var(--success)">â¬† Incremental Loans</div>
              <div class="result-value" style="color: var(--success)" id="o_inc_funded">â€”</div>
              <div class="result-desc" id="o_inc_funded_mini">Additional funded applications</div>
            </div>

            <div class="result-card" style="border-color: var(--success); border-width: 3px;">
              <div class="result-label" style="color: var(--success)">â¬† Incremental Revenue</div>
              <div class="result-value" style="color: var(--success)" id="o_inc_rev">â€”</div>
              <div class="result-desc" id="o_inc_rev_mini">Additional revenue from measurement</div>
            </div>
          </div>

          <div class="nav-buttons">
            <button class="btn-nav" onclick="prevPage()">Previous</button>
            <button class="btn-nav primary" onclick="downloadPDF()">Download PDF Report</button>
            <button class="btn-nav" onclick="copyLink()">Copy Shareable Link</button>
          </div>
        </div>

        <div class="info-panel">
          <h3 class="info-title">Understanding Your Impact</h3>
          <div class="info-content">
            <p>These results show the projected performance of your digital marketing investment with and without measurement-driven optimization.</p>
            
            <div class="info-highlight">
              ðŸŽ¯ <strong>Key Insight:</strong> The incremental revenue represents the additional business value created by implementing proper measurement and attribution.
            </div>
            
            <p><strong>What drives the lift:</strong></p>
            <ul>
              <li><strong>Smarter targeting:</strong> Measurement reveals which audiences convert best</li>
              <li><strong>Creative optimization:</strong> Real-time insights show what messaging works</li>
              <li><strong>Budget efficiency:</strong> Allocate spend to highest-performing channels</li>
              <li><strong>Faster learning:</strong> Shorten the cycle from test to optimization</li>
            </ul>
            
            <p><strong>Next steps:</strong></p>
            <ul>
              <li>Download the PDF report to share with stakeholders</li>
              <li>Adjust inputs to model different scenarios</li>
              <li>Contact Semcasting to discuss implementation</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  let currentPage = 1;
  const totalPages = 5;

  const els = {
    benchmarkSelect: $("benchmarkSelect"),
    budget: $("budget"),
    cpm: $("cpm"),
    ctr: $("ctr"),
    startRate: $("startRate"),
    completionRate: $("completionRate"),
    fundedRate: $("fundedRate"),
    siteVisitors: $("siteVisitors"),
    ltv: $("ltv"),
    liftPct: $("liftPct"),
    notes: $("notes"),
    err: $("err"),

    o_impr: $("o_impr"),
    o_impr_mini: $("o_impr_mini"),
    o_starts: $("o_starts"),
    o_starts_mini: $("o_starts_mini"),
    o_comp: $("o_comp"),
    o_comp_mini: $("o_comp_mini"),
    o_funded: $("o_funded"),
    o_funded_mini: $("o_funded_mini"),
    o_rev_base: $("o_rev_base"),
    o_rev_base_mini: $("o_rev_base_mini"),
    o_rev_meas: $("o_rev_meas"),
    o_rev_meas_mini: $("o_rev_meas_mini"),
    o_inc_funded: $("o_inc_funded"),
    o_inc_funded_mini: $("o_inc_funded_mini"),
    o_inc_rev: $("o_inc_rev"),
    o_inc_rev_mini: $("o_inc_rev_mini"),
  };

  // Benchmarks
  const BENCHMARKS = {
    standard: {
      budget: 10000000,
      cpm: 15,
      ctr: 0.15,
      startRate: 0.40,
      completionRate: 40,
      fundedRate: 50,
      siteVisitors: 1200000,
      ltv: 9000,
      liftPct: 10
    },
    conservative: {
      budget: 5000000,
      cpm: 18,
      ctr: 0.10,
      startRate: 0.30,
      completionRate: 35,
      fundedRate: 45,
      siteVisitors: 800000,
      ltv: 9000,
      liftPct: 7.5
    },
    aggressive: {
      budget: 15000000,
      cpm: 12,
      ctr: 0.25,
      startRate: 0.60,
      completionRate: 45,
      fundedRate: 60,
      siteVisitors: 1500000,
      ltv: 9000,
      liftPct: 15
    }
  };

  // Navigation
  function nextPage(){
    if (currentPage < totalPages){
      currentPage++;
      showPage(currentPage);
    }
  }

  function prevPage(){
    if (currentPage > 1){
      currentPage--;
      showPage(currentPage);
    }
  }

  function showPage(pageNum){
    // Hide all pages
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    // Show current page
    $('page' + pageNum).classList.add('active');
    
    // Update stepper
    document.querySelectorAll('.step').forEach((step, idx) => {
      step.classList.remove('active', 'completed');
      if (idx + 1 < pageNum) step.classList.add('completed');
      if (idx + 1 === pageNum) step.classList.add('active');
    });
    
    // Update progress bar
    const progress = (pageNum / totalPages) * 100;
    $('progressBar').style.width = progress + '%';
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // Helpers
  function stripNonNumeric(s){ return (s || "").toString().replace(/[^0-9.]/g, ""); }
  function parseNumberFromInput(el){
    const raw = stripNonNumeric(el.value).replace(/(\..*)\./g, "$1");
    const n = parseFloat(raw);
    return isFinite(n) ? n : NaN;
  }

  function setFormattedCurrency(el, value, decimals){
    if (!isFinite(value)) { el.value = ""; return; }
    const d = (typeof decimals === "number") ? decimals : 2;
    el.value = value.toLocaleString(undefined, { minimumFractionDigits: d, maximumFractionDigits: d });
  }
  
  function setFormattedInteger(el, value){
    if (!isFinite(value)) { el.value = ""; return; }
    el.value = Math.round(value).toLocaleString(undefined, { maximumFractionDigits: 0 });
  }
  
  function setFormattedPercent(el, value){
    if (!isFinite(value)) { el.value = ""; return; }
    const v = Math.round(value * 100) / 100;
    el.value = String(v);
  }

  function fmtMoney0(x){
    if (!isFinite(x)) return "â€”";
    return x.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0});
  }
  
  function fmtInt(x){
    if (!isFinite(x)) return "â€”";
    return x.toLocaleString(undefined,{maximumFractionDigits:0});
  }

  function showErr(msg){
    els.err.style.display = msg ? "block" : "none";
    els.err.textContent = msg || "";
  }

  function wireCurrency(id, defaultValue, decimals){
    const el = $(id);
    el.addEventListener("focus", () => {
      const n = parseNumberFromInput(el);
      el.value = isFinite(n) ? String(n) : "";
    });
    el.addEventListener("blur", () => {
      const n = parseNumberFromInput(el);
      const v = isFinite(n) ? n : defaultValue;
      setFormattedCurrency(el, v, decimals);
    });
  }

  function wireInteger(id, defaultValue){
    const el = $(id);
    el.addEventListener("focus", () => {
      const n = parseNumberFromInput(el);
      el.value = isFinite(n) ? String(Math.round(n)) : "";
    });
    el.addEventListener("blur", () => {
      const n = parseNumberFromInput(el);
      setFormattedInteger(el, isFinite(n) ? n : defaultValue);
    });
  }

  function wirePercent(id){
    const el = $(id);
    el.addEventListener("blur", () => {
      const n = parseFloat(el.value || "0");
      const clamped = Math.min(Math.max(isFinite(n) ? n : 0, 0), 100);
      el.value = String(Math.round(clamped * 100) / 100);
    });
  }

  function pctToDec(percentNumber, name){
    if (!isFinite(percentNumber)) throw new Error(`${name} must be a number.`);
    if (percentNumber < 0 || percentNumber > 100) throw new Error(`${name} must be between 0 and 100.`);
    return percentNumber / 100.0;
  }

  function readInputs(){
    const budget = parseNumberFromInput(els.budget);
    if (!isFinite(budget) || budget < 0) throw new Error("Budget must be a number â‰¥ 0.");

    const cpm = parseNumberFromInput(els.cpm);
    if (!isFinite(cpm) || cpm < 2) throw new Error("CPM must be a number â‰¥ 2.");

    const ctr = pctToDec(parseNumberFromInput(els.ctr), "Click-Through Rate (%)");
    const startRate = pctToDec(parseNumberFromInput(els.startRate), "Application Start Rate (%)");
    const completionRate = pctToDec(parseNumberFromInput(els.completionRate), "Application Completion Rate (%)");
    const fundedRate = pctToDec(parseNumberFromInput(els.fundedRate), "Application Funded Rate (%)");

    const siteVisitors = parseNumberFromInput(els.siteVisitors);
    if (!isFinite(siteVisitors) || siteVisitors < 0) throw new Error("Site Visitors must be a number â‰¥ 0.");

    const ltv = parseNumberFromInput(els.ltv);
    if (!isFinite(ltv) || ltv < 0) throw new Error("Lifetime Value must be â‰¥ 0.");

    const liftPct = pctToDec(parseNumberFromInput(els.liftPct), "Incremental Lift (%)");

    return { budget, cpm, ctr, startRate, completionRate, fundedRate, siteVisitors, ltv, liftPct };
  }

  function calculate(){
    try{
      showErr("");
      const i = readInputs();

      const impressions = (i.budget / i.cpm) * 1000;
      const totalStarts = impressions * i.ctr * i.startRate;
      const totalCompletions = totalStarts * i.completionRate;
      const totalFunded = totalCompletions * i.fundedRate;

      const baseRevenue = totalFunded * i.ltv;

      const measFunded = totalFunded * (1 + i.liftPct);
      const measRevenue = measFunded * i.ltv;

      const incFunded = measFunded - totalFunded;
      const incRevenue = measRevenue - baseRevenue;

      els.o_impr.textContent = fmtInt(impressions);
      els.o_impr_mini.textContent = "From your media budget and CPM";

      els.o_starts.textContent = fmtInt(totalStarts);
      els.o_starts_mini.textContent = "Based on CTR and start rate";

      els.o_comp.textContent = fmtInt(totalCompletions);
      els.o_comp_mini.textContent = "Applications that are completed";

      els.o_funded.textContent = fmtInt(totalFunded);
      els.o_funded_mini.textContent = "Successfully funded loans";

      els.o_rev_base.textContent = fmtMoney0(baseRevenue);
      els.o_rev_base_mini.textContent = "Total revenue without optimization";

      els.o_rev_meas.textContent = fmtMoney0(measRevenue);
      els.o_rev_meas_mini.textContent = "Total revenue with measurement";

      els.o_inc_funded.textContent = fmtInt(incFunded);
      els.o_inc_funded_mini.textContent = "Additional loans from measurement";

      els.o_inc_rev.textContent = fmtMoney0(incRevenue);
      els.o_inc_rev_mini.textContent = "Additional revenue from measurement";

      nextPage();
    } catch(e){
      showErr(e.message || "Please check your inputs.");
    }
  }

  function applyPreset(presetKey){
    const b = BENCHMARKS[presetKey] || BENCHMARKS.standard;

    setFormattedCurrency(els.budget, b.budget, 0);
    setFormattedCurrency(els.cpm, b.cpm, 2);
    setFormattedPercent(els.ctr, b.ctr);
    setFormattedPercent(els.startRate, b.startRate);
    setFormattedPercent(els.completionRate, b.completionRate);
    setFormattedPercent(els.fundedRate, b.fundedRate);
    setFormattedInteger(els.siteVisitors, b.siteVisitors);
    setFormattedCurrency(els.ltv, b.ltv, 2);
    setFormattedPercent(els.liftPct, b.liftPct);

    showErr("");
    currentPage = 1;
    showPage(1);
  }

  function downloadPDF(){
    const snap = getSnapshot();
    const style = `
      <style>
        @page { margin: 18mm; }
        body{ font-family: system-ui, sans-serif; color:#111; }
        .hdr{ display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
        .logo{ width:30px; height:30px; border-radius:8px; background: linear-gradient(135deg, #2f5bff, #7aa2ff); display:inline-block; }
        h1{ font-size: 18px; margin:0; }
        .meta{ font-size: 11px; color:#666; }
        .box{ border:1px solid #ddd; border-radius: 10px; padding: 16px; margin: 16px 0; }
        h2{ font-size: 14px; margin: 0 0 12px; font-weight:800; }
        table{ width:100%; border-collapse: collapse; font-size: 13px; }
        td{ padding: 10px 8px; border-bottom: 1px solid #eee; }
        td:first-child{ width: 65%; }
        td:last-child{ text-align:right; font-weight:700; }
      </style>
    `;

    const escapeHtml = (str) => (str || "").toString()
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");

    const inputs = [
      ["Marketing Budget", "$" + escapeHtml(els.budget.value)],
      ["Blended CPM", "$" + escapeHtml(els.cpm.value)],
      ["Click-Through Rate", escapeHtml(els.ctr.value) + "%"],
      ["Application Start Rate", escapeHtml(els.startRate.value) + "%"],
      ["Completion Rate", escapeHtml(els.completionRate.value) + "%"],
      ["Funded Rate", escapeHtml(els.fundedRate.value) + "%"],
      ["Site Visitors", escapeHtml(els.siteVisitors.value)],
      ["LTV Per Loan", "$" + escapeHtml(els.ltv.value)],
      ["Measurement Lift", escapeHtml(els.liftPct.value) + "%"],
    ];

    const outputs = [
      ["Total Impressions", escapeHtml(els.o_impr.textContent)],
      ["Application Starts", escapeHtml(els.o_starts.textContent)],
      ["Completions", escapeHtml(els.o_comp.textContent)],
      ["Funded Loans", escapeHtml(els.o_funded.textContent)],
      ["Base Revenue", escapeHtml(els.o_rev_base.textContent)],
      ["Revenue with Measurement", escapeHtml(els.o_rev_meas.textContent)],
      ["Incremental Loans", escapeHtml(els.o_inc_funded.textContent)],
      ["Incremental Revenue", escapeHtml(els.o_inc_rev.textContent)],
    ];

    const rows = (arr) => arr.map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join("");

    const html = `
      <!doctype html>
      <html>
      <head><meta charset="utf-8">${style}<title>Semcasting Report</title></head>
      <body onload="setTimeout(()=>window.print(),250)">
        <div class="hdr">
          <div>
            <div class="logo"></div>
            <h1>Semcasting â€” Media Performance Report</h1>
          </div>
          <div class="meta">Generated ${new Date().toLocaleString()}</div>
        </div>
        ${els.notes.value ? `<div class="box"><h2>Notes</h2><p>${escapeHtml(els.notes.value)}</p></div>` : ""}
        <div class="box"><h2>Inputs</h2><table>${rows(inputs)}</table></div>
        <div class="box"><h2>Results</h2><table>${rows(outputs)}</table></div>
      </body>
      </html>
    `;

    const w = window.open("", "_blank");
    if (w) {
      w.document.write(html);
      w.document.close();
    }
  }

  function getSnapshot(){
    return { generatedAt: new Date().toLocaleString() };
  }

  function copyLink(){
    navigator.clipboard.writeText(location.href).then(()=>{
      alert('Link copied to clipboard!');
    });
  }

  // Wire inputs
  wireCurrency("budget", BENCHMARKS.standard.budget, 0);
  wireCurrency("cpm", BENCHMARKS.standard.cpm, 2);
  wireCurrency("ltv", BENCHMARKS.standard.ltv, 2);
  wireInteger("siteVisitors", BENCHMARKS.standard.siteVisitors);
  ["ctr","startRate","completionRate","fundedRate","liftPct"].forEach(wirePercent);

  // Init
  applyPreset("standard");

  // Events
  els.benchmarkSelect.addEventListener("change", () => applyPreset(els.benchmarkSelect.value));
  $("resetBtn").addEventListener("click", () => applyPreset(els.benchmarkSelect.value));
</script>
</body>
</html>
