<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Incremental Media Performance Calculator</title>
  <style>
    :root{
      --text:#111827;
      --muted:#6b7280;
      --border:#e5e7eb;
      --bg:#ffffff;
      --panel:#f9fafb;
      --primary:#111827;
      --primaryText:#ffffff;
      --radius:14px;
      --shadow:0 10px 25px rgba(0,0,0,.06);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    body{ margin:0; font-family:var(--font); color:var(--text); background:#f3f4f6; }
    .wrap{ max-width:980px; margin:32px auto; padding:0 16px; }
    .card{ background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; }
    .header{
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 20px; border-bottom:1px solid var(--border); background:linear-gradient(180deg,#fff,#fbfbfb);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:700; letter-spacing:.2px;
    }
    .dot{ width:10px; height:10px; border-radius:999px; background:#2563eb; } /* light brand accent */
    .sub{ color:var(--muted); font-size:13px; font-weight:500; }
    .content{ padding:20px; }
    .title{
      font-weight:800;
      font-size:22px; /* 2 sizes larger than input text */
      line-height:1.25;
      margin:0 0 16px 0;
    }

    .grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px; }
    @media (max-width:820px){ .grid{ grid-template-columns:1fr; } }

    .field{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; }
    .label{ display:flex; justify-content:space-between; gap:10px; font-size:13px; font-weight:700; margin-bottom:8px; }
    .hint{ color:var(--muted); font-weight:600; font-size:12px; }

    .inputWrap{ position:relative; }
    .prefix, .suffix{
      position:absolute; top:50%; transform:translateY(-50%);
      color:var(--muted); font-weight:800; font-size:14px;
      pointer-events:none;
    }
    .prefix{ left:12px; }
    .suffix{ right:12px; } /* keeps % tight to the number on the right */
    input{
      width:100%;
      font-size:15px;
      padding:12px 12px;
      border-radius:10px;
      border:1px solid var(--border);
      outline:none;
      background:#fff;
      box-sizing:border-box;
    }
    input.money{ padding-left:28px; }
    input.percent{ padding-right:28px; text-align:right; }
    input:focus{ border-color:#c7d2fe; box-shadow:0 0 0 4px rgba(99,102,241,.12); }

    .actions{ margin-top:16px; display:flex; gap:10px; flex-wrap:wrap; }
    .btn{
      border:0; border-radius:12px; padding:14px 18px;
      font-weight:800; font-size:16px; cursor:pointer;
    }
    .btn.primary{ background:var(--primary); color:var(--primaryText); min-width:240px; }
    .btn.secondary{ background:#e5e7eb; color:#111827; }
    .btn:active{ transform:translateY(1px); }

    /* Outputs under inputs */
    .outputs{
      margin-top:18px;
      border-top:1px solid var(--border);
      padding-top:18px;
    }
    .outputs h2{ margin:0 0 10px 0; font-size:16px; }
    .outGrid{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:12px; }
    @media (max-width:900px){ .outGrid{ grid-template-columns:1fr; } }
    .kpi{
      border:1px solid var(--border); border-radius:12px; padding:12px;
      background:#fff;
    }
    .kpi .k{ color:var(--muted); font-weight:800; font-size:12px; }
    .kpi .v{ margin-top:6px; font-size:18px; font-weight:900; }

    /* Print/PDF styling */
    @media print{
      body{ background:#fff; }
      .wrap{ margin:0; max-width:none; padding:0; }
      .card{ box-shadow:none; border:0; border-radius:0; }
      .actions{ display:none !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="reportRoot">
      <div class="header">
        <div>
          <div class="brand"><span class="dot"></span>Semcasting</div>
          <div class="sub">Incremental Media Performance Calculator</div>
        </div>
        <div class="sub">Demo / Testing</div>
      </div>

      <div class="content">
        <p class="title">
          Please enter some basic business metrics to determine the impact of measurement for your financial organization.
        </p>

        <div class="grid">
          <!-- Budget ($) -->
          <div class="field">
            <div class="label">
              <span>Estimated Display and CTV Digital Marketing Budget</span>
              <span class="hint">benchmark</span>
            </div>
            <div class="inputWrap">
              <span class="prefix">$</span>
              <input id="budget" class="money" inputmode="decimal" value="0" />
            </div>
          </div>

          <!-- CPM ($) -->
          <div class="field">
            <div class="label">
              <span>Estimated Blended CPM</span>
              <span class="hint">benchmark</span>
            </div>
            <div class="inputWrap">
              <span class="prefix">$</span>
              <input id="cpm" class="money" inputmode="decimal" value="15" />
            </div>
          </div>

          <!-- App Start Rate (%) -->
          <div class="field">
            <div class="label">
              <span>Estimated Application Start Rate</span>
              <span class="hint">benchmark</span>
            </div>
            <div class="inputWrap">
              <input id="startRate" class="percent" inputmode="decimal" maxlength="5" value="0.40" />
              <span class="suffix">%</span>
            </div>
          </div>

          <!-- App Completion Rate (%) -->
          <div class="field">
            <div class="label">
              <span>Estimated Application Completion Rate</span>
              <span class="hint">benchmark</span>
            </div>
            <div class="inputWrap">
              <input id="completionRate" class="percent" inputmode="decimal" maxlength="5" value="40" />
              <span class="suffix">%</span>
            </div>
          </div>

          <!-- Funded Rate (%) -->
          <div class="field">
            <div class="label">
              <span>Estimated Application Funded Rate</span>
              <span class="hint">benchmark</span>
            </div>
            <div class="inputWrap">
              <input id="fundedRate" class="percent" inputmode="decimal" maxlength="5" value="50" />
              <span class="suffix">%</span>
            </div>
          </div>
        </div>

        <!-- Big submit button under inputs -->
        <div class="actions">
          <button class="btn primary" id="calcBtn">Calculate</button>
          <button class="btn secondary" id="pdfBtn">Download PDF</button>
        </div>

        <!-- Outputs below inputs -->
        <div class="outputs">
          <h2>Outputs</h2>
          <div class="outGrid">
            <div class="kpi">
              <div class="k">All Impressions Delivered</div>
              <div class="v" id="outImpressions">—</div>
            </div>
            <div class="kpi">
              <div class="k">Total Application Starts</div>
              <div class="v" id="outStarts">—</div>
            </div>
            <div class="kpi">
              <div class="k">Total Application Funded</div>
              <div class="v" id="outFunded">—</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ---------- Formatting helpers ----------
    const nf0 = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 });
    const nf2 = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    function stripNonNumeric(s){
      return String(s ?? '').replace(/[^0-9.\-]/g,'');
    }
    function parseCurrency(s){
      const n = parseFloat(stripNonNumeric(s));
      return Number.isFinite(n) ? n : 0;
    }
    function parsePercent(s){
      // User types "0.40" meaning 0.40% (not 40%)
      const n = parseFloat(stripNonNumeric(s));
      return Number.isFinite(n) ? n : 0;
    }
    function formatCurrency(n){
      return nf2.format(Number(n || 0));
    }
    function formatInteger(n){
      return nf0.format(Number(n || 0));
    }
    function clamp(n, min, max){
      return Math.min(Math.max(n, min), max);
    }

    function attachMoneyFormatting(id){
      const el = document.getElementById(id);
      el.addEventListener('focus', () => {
        // show raw number without commas while editing
        el.value = String(parseCurrency(el.value));
      });
      el.addEventListener('blur', () => {
        const v = parseCurrency(el.value);
        el.value = formatCurrency(v);
      });
      // initialize formatted
      el.value = formatCurrency(parseCurrency(el.value));
    }

    function attachPercentRules(id){
      const el = document.getElementById(id);

      el.addEventListener('input', () => {
        // allow only digits + one dot; max 2 decimals
        let v = stripNonNumeric(el.value);
        const parts = v.split('.');
        if (parts.length > 2) v = parts[0] + '.' + parts.slice(1).join('');
        if (v.includes('.')) {
          const [a,b] = v.split('.');
          v = a + '.' + (b ?? '').slice(0,2);
        }
        // hard clamp 0-100
        const num = clamp(parseFloat(v || '0'), 0, 100);
        // preserve typing feel: don’t over-format mid-entry
        el.value = String(Number.isFinite(num) ? (v.endsWith('.') ? v : v) : 0).slice(0, el.maxLength || 10);
      });

      el.addEventListener('blur', () => {
        const num = clamp(parsePercent(el.value), 0, 100);
        // keep tidy: show up to 2 decimals, but don’t force trailing zeros unless you want
        el.value = (Math.round(num * 100) / 100).toString();
      });
    }

    // ---------- Wire up inputs ----------
    attachMoneyFormatting('budget');
    attachMoneyFormatting('cpm');
    attachPercentRules('startRate');
    attachPercentRules('completionRate');
    attachPercentRules('fundedRate');

    // ---------- Calculation ----------
    function calculate(){
      const budget = parseCurrency(document.getElementById('budget').value);
      const cpm = Math.max(parseCurrency(document.getElementById('cpm').value), 2);

      const startPct = parsePercent(document.getElementById('startRate').value);       // e.g. 0.40
      const completionPct = parsePercent(document.getElementById('completionRate').value); // e.g. 40
      const fundedPct = parsePercent(document.getElementById('fundedRate').value);     // e.g. 50

      // Impressions = (Budget / CPM) * 1000
      const impressions = (budget / cpm) * 1000;

      // NOTE: Your workbook uses CTR/VTR too; if your current calculator already has it, keep it.
      // Here, we can only compute starts/funded using the rates you provided.
      // If you want starts/funded to reflect CTR/VTR, add that input back and multiply it in.

      // Interpreting: startPct is percent (0.40%) => decimal = 0.004
      const startRate = startPct / 100.0;
      const completionRate = completionPct / 100.0;
      const fundedRate = fundedPct / 100.0;

      const totalStarts = impressions * startRate;
      const totalFunded = totalStarts * completionRate * fundedRate;

      document.getElementById('outImpressions').textContent = formatInteger(impressions);
      document.getElementById('outStarts').textContent = formatInteger(totalStarts);
      document.getElementById('outFunded').textContent = formatInteger(totalFunded);
    }

    document.getElementById('calcBtn').addEventListener('click', calculate);

    // ---------- PDF ----------
    // Most reliable for static hosting: open print dialog; user "Save as PDF"
    document.getElementById('pdfBtn').addEventListener('click', () => {
      // ensure outputs are current before printing
      calculate();
      window.print();
    });

    // initial calc so page isn't blank
    calculate();
  </script>
</body>
</html>
